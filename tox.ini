[tox]
envlist=py36
skipsdist=True

[testenv]
whitelist_externals=
    mv
    rm
deps=
    -r{toxinidir}/requirements.txt
    aiohttp
    asynctest
    pytest-asyncio
    requests
    isort>=4.2.5
    pytest>=3.1.0
    pytest-cov>=2.5.1
    pytest-html>=1.14.2
    pytest-mock>=1.6.0
    pytest-profiling>=1.2.6
    pylint>=1.7.1
    pylint-quotes>=0.1.5


[testenv:unit]
commands=
    pip install synse_plugin-0.0.1.tar.gz
    pytest -s \
        --junitxml=results/pytest/junit.xml \
        --cov-report html:results/cov-html \
        --cov-report term \
        --cov=synse \
        --html=results/pytest/index.html \
        --self-contained-html \
        --profile \
        tests/unit {posargs}
    rm -rf results/prof
    mv prof results


[testenv:integration]
commands=
    pip install synse_plugin-0.0.1.tar.gz
    pytest -s \
        --profile \
        tests/integration {posargs}


[testenv:end-to-end]
commands=
    pip install synse_plugin-0.0.1.tar.gz
    pytest -s tests/end-to-end/test.py


[testenv:lint]
commands=
    pip install synse_plugin-0.0.1.tar.gz
    isort synse tests -rc -c --diff
    pylint --additional-builtins="gettext" --load-plugins pylint_quotes synse tests
