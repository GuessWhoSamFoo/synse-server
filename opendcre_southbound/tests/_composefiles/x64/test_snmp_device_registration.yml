# This is the container running the tests.
# Link to the opendcre web service, not the SNMP emulator.
test-container-x64:
  container_name: test-container-x64
  build: ../../../..
  dockerfile: dockerfile/Dockerfile.x64
  command: bash -c "sleep 15 && python ./opendcre_southbound/tests/test-snmp-device-registration.py"
  links:
    - opendcre-southbound-test-container

# This container is where opendcre is running.
# Allows us to make web service calls against it.
opendcre-southbound-test-container:
  build: ../../../..
  dockerfile: dockerfile/Dockerfile.x64
  command: ./start_opendcre.sh
  ports:
    - 5000:5000
  volumes:
    - ../../data/opendcre_snmp_config.json:/opendcre/override/config.json
    - ../../data/snmp_config/merged/test_snmp_device_registration/snmp_config.json:/opendcre/snmp_config.json
  environment:
    - VAPOR_DEBUG=true
  links:
    - snmp-emulator-rittal-rizone
    - snmp-emulator-opendcre-testdevice1-board1
    - snmp-emulator-opendcre-testdevice1-board2


# This is the container running the emulator to test against
# for the Rittal-RiZone snmp emulator.
snmp-emulator-rittal-rizone:
  container_name: snmp-emulator-rittal-rizone
  build: ../../../emulator/snmp
  dockerfile: Dockerfile-rittal-rizone.x64
  # This command will override what is in the dockerfile.
  command: ./start_snmp_emulator.sh ./data 11011 snmp-emulator-rittal-rizone.log
  ports:
    - 11011:11011/udp
  environment:
    - VAPOR_DEBUG=true

# This is the container running the emulator to test against
# for the OpenDCRE-TestDevice1 (board1) snmp emulator.
snmp-emulator-opendcre-testdevice1-board1:
  container_name: snmp-emulator-opendcre-testdevice1-board1
  build: ../../../emulator/snmp
  dockerfile: Dockerfile-opendcre-testdevice1-board1.x64
  # This command will override what is in the dockerfile.
  command: ./start_snmp_emulator.sh ./data 11012 snmp-emulator-opendcre-testdevice1-board1.log
  ports:
    - 11012:11012/udp
  environment:
    - VAPOR_DEBUG=true

# This is the container running the emulator to test against
# for the OpenDCRE-TestDevice1 (board2) snmp emulator.
snmp-emulator-opendcre-testdevice1-board2:
  container_name: snmp-emulator-opendcre-testdevice1-board2
  build: ../../../emulator/snmp
  dockerfile: Dockerfile-opendcre-testdevice1-board2.x64
  # This command will override what is in the dockerfile.
  command: ./start_snmp_emulator.sh ./data 11013 snmp-emulator-opendcre-testdevice1-board2.log
  ports:
    - 11013:11013/udp
  environment:
    - VAPOR_DEBUG=true
